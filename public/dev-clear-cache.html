<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clear Development Cache - Welmora Scanner</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .danger {
        background: #dc3545;
      }
      .danger:hover {
        background: #c82333;
      }
      .success {
        background: #28a745;
      }
      .success:hover {
        background: #1e7e34;
      }
      #status {
        margin-top: 20px;
        padding: 10px;
        border-radius: 5px;
        display: none;
      }
      .status-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üõ†Ô∏è Development Cache Manager</h1>
      <p>Use these tools to manage service worker cache during development:</p>

      <div>
        <button onclick="clearAllCaches()">üóëÔ∏è Clear All Caches</button>
        <button onclick="unregisterServiceWorker()" class="danger">
          ‚ùå Unregister Service Worker
        </button>
        <button onclick="reloadApp()" class="success">üîÑ Reload App</button>
      </div>

      <div>
        <button onclick="checkCacheStatus()">üìä Check Cache Status</button>
        <button onclick="forceUpdate()">‚ö° Force SW Update</button>
      </div>

      <div id="status"></div>

      <hr style="margin: 30px 0" />

      <h3>üöÄ Quick Actions:</h3>
      <ul>
        <li><strong>Clear All Caches:</strong> Removes all cached files</li>
        <li><strong>Unregister Service Worker:</strong> Completely removes the service worker</li>
        <li><strong>Force SW Update:</strong> Forces service worker to update</li>
        <li><strong>Reload App:</strong> Refreshes the main application</li>
      </ul>

      <p><a href="/" style="color: #007bff">‚Üê Back to Welmora Scanner</a></p>
    </div>

    <script>
      function showStatus(message, isError = false) {
        const status = document.getElementById('status');
        status.textContent = message;
        status.className = isError ? 'status-error' : 'status-success';
        status.style.display = 'block';

        setTimeout(() => {
          status.style.display = 'none';
        }, 5000);
      }

      async function clearAllCaches() {
        try {
          const cacheNames = await caches.keys();
          await Promise.all(cacheNames.map(name => caches.delete(name)));
          showStatus(`‚úÖ Cleared ${cacheNames.length} cache(s): ${cacheNames.join(', ')}`);
        } catch (error) {
          showStatus(`‚ùå Error clearing caches: ${error.message}`, true);
        }
      }

      async function unregisterServiceWorker() {
        try {
          if ('serviceWorker' in navigator) {
            const registrations = await navigator.serviceWorker.getRegistrations();
            for (const registration of registrations) {
              await registration.unregister();
            }
            showStatus(`‚úÖ Unregistered ${registrations.length} service worker(s)`);
          } else {
            showStatus('‚ùå Service Worker not supported', true);
          }
        } catch (error) {
          showStatus(`‚ùå Error unregistering service worker: ${error.message}`, true);
        }
      }

      async function checkCacheStatus() {
        try {
          const cacheNames = await caches.keys();
          let totalSize = 0;
          let totalEntries = 0;

          for (const name of cacheNames) {
            const cache = await caches.open(name);
            const keys = await cache.keys();
            totalEntries += keys.length;
          }

          const swStatus =
            'serviceWorker' in navigator
              ? navigator.serviceWorker.controller
                ? 'Active'
                : 'Inactive'
              : 'Not Supported';

          showStatus(
            `üìä Cache Status: ${cacheNames.length} cache(s), ${totalEntries} entries total. SW: ${swStatus}`
          );
        } catch (error) {
          showStatus(`‚ùå Error checking cache: ${error.message}`, true);
        }
      }

      async function forceUpdate() {
        try {
          if ('serviceWorker' in navigator) {
            const registration = await navigator.serviceWorker.getRegistration();
            if (registration) {
              await registration.update();
              showStatus('‚úÖ Service worker update forced');
            } else {
              showStatus('‚ùå No service worker registered', true);
            }
          } else {
            showStatus('‚ùå Service Worker not supported', true);
          }
        } catch (error) {
          showStatus(`‚ùå Error forcing update: ${error.message}`, true);
        }
      }

      function reloadApp() {
        window.open('/', '_blank');
        showStatus('üîÑ Opening main app in new tab');
      }

      // Auto-check status on load
      window.addEventListener('load', checkCacheStatus);
    </script>
  </body>
</html>
